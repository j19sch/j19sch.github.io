<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="The thin line between value and distraction">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How adding a flex-wrap almost spiraled out of control | Joep Schuurkes</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/atom+xml" title="Atom" hreflang="en" href="../../feed.atom">
<link rel="canonical" href="https://smallsheds.garden/blog/2025/how-adding-a-flex-wrap-almost-spiraled-out-of-control/">
<link rel="icon" href="../../../assets/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" href="../../../assets/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" href="../../../assets/favicons/favicon-96x96.png" sizes="96x96">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><script defer data-domain="j19sch.github.io" src="https://plausible.io/js/plausible.js"></script><meta name="author" content="Joep Schuurkes">
<link rel="prev" href="../some-of-the-things-i-did-after-being-off-for-a-few-weeks/" title="Some of the things I did after being off for a few weeks" type="text/html">
<link rel="next" href="../the-five-areas-of-agile/" title="The five areas of Agile" type="text/html">
<meta property="og:site_name" content="Joep Schuurkes">
<meta property="og:title" content="How adding a flex-wrap almost spiraled out of control">
<meta property="og:url" content="https://smallsheds.garden/blog/2025/how-adding-a-flex-wrap-almost-spiraled-out-of-control/">
<meta property="og:description" content="The thin line between value and distraction">
<meta property="og:image" content="https://smallsheds.garden/images/2025/flex-wrap/cards-before.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-08-24T00:00:00+02:00">
<meta property="article:tag" content="agile">
<meta property="article:tag" content="bugs">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="software development">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../../">

            <span id="blog-title">Joep Schuurkes</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav"></ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item dropdown">
<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Blog</a>
            <div class="dropdown-menu">
                    <a href="../../" class="dropdown-item">My blog</a>
                    <a href="../../../categories/" class="dropdown-item">Categories and tags</a>
                    <a href="../../../archive.html" class="dropdown-item">Archive</a>
                    <a href="../../rss.xml" class="dropdown-item"><span class="caps">RSS</span> feed</a>
                    <a href="../../feed.atom" class="dropdown-item">Atom feed</a>
            </div>
                </li>
<li class="nav-item">
<a href="../../../my-projects/" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../../my-talks/" class="nav-link">Talks</a>
                </li>
<li class="nav-item">
<a href="../../../index.html" class="nav-link">About&nbsp;me</a>

                
            </li>
</ul>
<div id="search" style="text-align: center;margin-left: 40px; margin-right: 40px">
                <form method="get" id="search" target="_blank" action="https://noai.duckduckgo.com/">
                    <input type="hidden" name="sites" value="https://smallsheds.garden/"><input type="hidden" name="k8" value="#444444"><!-- text color code --><input type="hidden" name="k9" value="#D51920"><!-- links color code --><input type="hidden" name="kt" value="h"><!-- text font --><input type="text" name="q" size="14" maxlength="255" placeholder="Search..." arial-label="search this site" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="display:none;">
</form>
            </div>
        </div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">How adding a flex-wrap almost spiraled out of&nbsp;control</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Joep&nbsp;Schuurkes
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2025-08-24T00:00:00+02:00" itemprop="datePublished" title="24 August 2025">24 August 2025</time></a>
            </p>
            
        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <blockquote>
<p><em>How does a project get to be a year late?</em><br><em>&#8230;One day at a time.</em><br>
- The Mythical Man-Month (anniversary edition), Frederick P. Brooks Jr., p.&nbsp;153</p>
</blockquote>
<p>Last week I found a minor bug in the <a href="https://github.com/kiesraad/abacus">application</a> my team is building. For every election committee, we have a page showing all sessions of that committee. These sessions are shown as a row of cards. Playing around with the number of sessions, I discovered that the row keeps on growing, resulting in a horizontal scroll&nbsp;bar:</p>
<p><img alt="screenshot showing five committee session cards in a row, with the last one, all the way to the right, having only a small part of its left side visible" src="../../../images/2025/flex-wrap/cards-before.png"></p>
<!-- TEASER_END -->

<p>Having found this bug, I checked with our <span class="caps">UX</span> specialist and they confirmed: the cards should overflow into a second row&nbsp;instead.</p>
<h2>Fixing the&nbsp;bug</h2>
<p>This left me with the question: do I fix this bug or&nbsp;not?</p>
<p>In favor of not fixing the bug is that it&#8217;s extremely rare to have four committee sessions and thus cards, let alone five. Once you&#8217;re on your fifth session, having to use a scroll bar to the card of the first session, is probably the least of your concerns. So this bug fits perfectly into the <em>&#8220;fine if we never fix it, so forget about it&#8221;</em>-category of our zero bug policy. Also, my team is working towards a deadline and we can&#8217;t really afford any&nbsp;distractions.</p>
<p>In favor of fixing the bug was that presumably the fix would be really simple. I was fairly confident we were already using <a href="https://css-tricks.com/snippets/css/a-guide-to-flexbox/"><span class="caps">CSS</span> flexbox</a> on the cards. In that case all I needed to do was add&nbsp;a <code>flex-wrap: wrap</code> to the container&#8217;s&nbsp;class.</p>
<p>So I went to the component&#8217;s <span class="caps">CSS</span>-file, saw that the container had&nbsp;a <code>display: flex</code> and added&nbsp;the <code>flex-wrap</code>. That left me with the job of verifying that this had actually fixed the&nbsp;issue.</p>
<p>The easiest way to do this, was to use our mock service worker to provide data to the front end. Unfortunately the mock response only contained two committee sessions. (I don&#8217;t think I considered using the data from when I found the bug. That would only be viable if I hadn&#8217;t reset the data in the meantime.) So I added a few sessions and saw the cards overflowing into the next&nbsp;row:</p>
<p><img alt="screenshot showing five committee session cards, three on the first row, two on the second row" src="../../../images/2025/flex-wrap/cards-after.png"></p>
<h2>Updating the mock service&nbsp;data</h2>
<p>This is where I could have declared the fix done. Submit a pull request with as only change the addition of a single line to the component&#8217;s css file. Explain how to temporarily edit the mock data to test the fix and why I didn&#8217;t think it made sense to have that change permanently in the mock&nbsp;data.</p>
<p>That&#8217;s not what I&nbsp;did.</p>
<p>I increased the number of committee sessions in the mock data to four. And something in those changes caused some component tests<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> to fail. (While at it, I also changed the order of the committee sessions in the mock data, to match the order they would be returned in by the back&nbsp;end.)</p>
<h2>Fixing the&nbsp;tests</h2>
<p>Ideally, <a href="../../2024/what-do-you-fix-when-you-fix-a-test/">fixing the tests</a> would be as simple as making the tests take the two additional committee sessions into account. Alas, it was not that&nbsp;simple.</p>
<p>In the test we care both about which session it is, e.g. &#8220;third session&#8221;, and its state, e.g. &#8220;data entry in progress&#8221;. The first one is shown in bold, the second not. And unfortunately React Testing Library&#8217;s <a href="https://testing-library.com/docs/queries/bytext"><code>ByText</code></a> query can&#8217;t deal with this very well. Because of the bold-tag it considers the two pieces of text as two separate nodes. Which makes perfect sense at the <span class="caps">DOM</span>-level, but not so much on the&nbsp;eyeball-level.</p>
<p>For the tests and test data as they were, with two committee session each with a different status, this wasn&#8217;t much of a problem. The tests asserted on the two parts of each session&nbsp;separately:</p>
<div class="code"><pre class="code literal-block"><span class="nx">expect</span><span class="p">(</span><span class="nx">within</span><span class="p">(</span><span class="nx">committee_session_cards</span><span class="p">).</span><span class="nx">getByText</span><span class="p">(</span><span class="s2">"Tweede zitting"</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">within</span><span class="p">(</span><span class="nx">committee_session_cards</span><span class="p">).</span><span class="nx">getByText</span><span class="p">(</span><span class="s2">"— Steminvoer bezig"</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">within</span><span class="p">(</span><span class="nx">committee_session_cards</span><span class="p">).</span><span class="nx">getByText</span><span class="p">(</span><span class="s2">"Eerste zitting"</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
<span class="nx">expect</span><span class="p">(</span><span class="nx">within</span><span class="p">(</span><span class="nx">committee_session_cards</span><span class="p">).</span><span class="nx">getByText</span><span class="p">(</span><span class="s2">"— Steminvoer afgerond"</span><span class="p">)).</span><span class="nx">toBeVisible</span><span class="p">();</span>
</pre></div>

<p>With four committee sessions, some of them having the same status, this solution would no longer&nbsp;work.</p>
<p>Luckily I found an <a href="https://stackoverflow.com/a/56859650">answer on Stack Overflow</a> explaining how you can solve this by providing a function to&nbsp;your <code>ByText</code> query instead of providing a string or regular expression. So I started adapting the example and tried to figure out to what degree I could re-use a helper function we had for a custom vitest matcher. I made some progress, but then it was time for our daily&nbsp;standup.</p>
<h2>Daily standup to the&nbsp;rescue</h2>
<p>In the standup I said I was working on fixing this bug, so we can forget about it. I explained the issue I had run into with the query and that I was afraid it might turn out to be quite a rabbit hole. That is, a distraction we can&#8217;t really afford at this time. And then I continued with <em>&#8220;Maybe I should just add an id to the cards.&#8221;</em> Which really only formed itself as an option in my mind as I was saying those&nbsp;words.</p>
<h2>Fixing the tests <em style="font-size: 0.45em;">(continued)</em>
</h2>
<p>After the standup I played around a little longer with providing a function to&nbsp;the <code>ByText</code> query. I think I got it to work, but it was nowhere near ready to be included in the pull request. I wasn&#8217;t entirely sure it worked. When the query couldn&#8217;t find the element, the error message was horrible, printing the whole function. And the function was inside the test, instead of in a more sensible&nbsp;location.</p>
<p>Realizing I shouldn&#8217;t invest a lot more time in this bug fix, I changed approach and added an id to the Card component, which was as trivial&nbsp;as <code>id={`session-${committeeSession.number}`}</code>.</p>
<p>Which allowed me to update the tests like&nbsp;this:</p>
<div class="code"><pre class="code literal-block"><span class="nx">expect</span><span class="p">(</span><span class="nx">within</span><span class="p">(</span><span class="nx">committee_session_cards</span><span class="p">).</span><span class="nx">getByTestId</span><span class="p">(</span><span class="s2">"session-1"</span><span class="p">)).</span><span class="nx">toHaveTextContent</span><span class="p">(</span>
<span class="w">  </span><span class="sr">/Eerste zitting — Steminvoer afgerond/</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>

<p>All this work resulted in <a href="https://github.com/kiesraad/abacus/pull/2029">this pull request</a> almost two hours after my first commit adding&nbsp;the <code>flex-wrap</code> to get the cards to overflow into a new&nbsp;row.</p>
<h2>Reflecting on the decisions I&nbsp;made</h2>
<p>Along the way I made four&nbsp;decisions:</p>
<ol>
<li>looking into fixing the&nbsp;bug</li>
<li>fixing the&nbsp;bug</li>
<li>updating the mock service&nbsp;data</li>
<li>switching to ids for the&nbsp;query</li>
</ol>
<p>And there&#8217;s one decision I did not make: abandoning the update of the mock service&nbsp;data.</p>
<p>I&#8217;m happy with the first two decisions. It made sense to check how easy it was to fix the bug and once I had determined it was trivial, to implement the&nbsp;fix.</p>
<p>The third decision was fine as such, except that it made some of the tests fail. At this point, I could have made the decision to abandon updating the mock data. Revert the change and be done with it. Because how important is it that the mock data contains a quite unrealistic number of committee sessions? At this point, however, I wasn&#8217;t making any conscious decisions, so I moved on to fixing the&nbsp;tests.</p>
<p>The fourth decision to switch to ids for the query was a good one, although a little late. Arguably, it&#8217;s also the better solution. The id will return the card, making it easy to query for anything in the card. The other solution will only return the title of the card, making it hard to query anything else in the card based on the title. While in general I prefer to query on things a user would see, this case seems a good example of where querying by id is the better&nbsp;approach.</p>
<div class="spacer-l"></div>

<p>Now what did these decisions get&nbsp;me?</p>
<p>A fixed bug. Mock data that&#8217;s sorted the same way as the real <span class="caps">API</span> response. I worked with a (to me) new part of the codebase. I learned a few things about Testing Library&#8217;s queries. The session cards are now easier to query in tests and the related tests are more robust. And it meant I was asking my team mates to review a significantly larger pull request with 72 lined added and 28 deleted, instead of one single line&nbsp;added.</p>
<p>Which raises the question: Apart from the bug fix which would have happened anyway, were those other benefits worth the extra&nbsp;time?</p>
<p>I&#8217;m not sure, to be honest. What do you&nbsp;think?</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>Testing types are <a href="https://smallsheds.garden/slides/rtc2019-testing-types.html#/">a hot mess</a>. The failing tests in question cover the React component showing (among other things) the session cards. They use <a href="https://testing-library.com/docs/react-testing-library/intro/">React Testing Library</a> and <a href="https://mswjs.io/">Mock Service Worker</a>. <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/agile/" rel="tag">agile</a></li>
            <li><a class="tag p-category" href="../../../categories/bugs/" rel="tag">bugs</a></li>
            <li><a class="tag p-category" href="../../../categories/programming/" rel="tag">programming</a></li>
            <li><a class="tag p-category" href="../../../categories/software-development/" rel="tag">software&nbsp;development</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../some-of-the-things-i-did-after-being-off-for-a-few-weeks/" rel="prev" title="Some of the things I did after being off for a few weeks">Previous&nbsp;post</a>
            </li>
            <li class="next">
                <a href="../the-five-areas-of-agile/" rel="next" title="The five areas of Agile">Next&nbsp;post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer">
            Contents © 2025 
<a href="https://creativecommons.org/licenses/by-nc/4.0/" rel="nofollow" target="_blank">
<img alt="Creative Commons BY-NC License" style="border-width:0;margin: 0px 0px 0px 0px" src="https://licensebuttons.net/l/by-nc/4.0/80x15.png"></a>
<a href="mailto:site@joep.slmail.me">Joep Schuurkes</a> - Powered by <a href="https://getnikola.com" rel="nofollow" target="_blank">Nikola</a> - Analytics by <a href="https://plausible.io/" rel="nofollow" target="_blank">Plausible</a>
            
        </footer>
</div>
</div>

        <script src="../../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>